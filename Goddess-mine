#!/bin/bash
# merge_to_goddess.sh
# 用途：將其他 7 個分支合併到 Goddess-mine

# 設定顏色輸出
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# 檢查是否在 git 倉庫中
if ! git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
    echo -e "${RED}錯誤：不在 git 倉庫中${NC}"
    exit 1
fi

# 先切換到 Goddess-mine
echo -e "${YELLOW}切換到 Goddess-mine 分支...${NC}"
git checkout Goddess-mine || git checkout -b Goddess-mine

# 確保 Goddess-mine 是最新的
echo -e "${YELLOW}更新 Goddess-mine 分支...${NC}"
git pull origin Goddess-mine 2>/dev/null || echo "首次合併或無遠端分支"

# 要合併的分支列表（依賴順序）
BRANCHES=(
    "Ai-main"           # AI 核心
    "Bot-main"          # LINE Bot
    "Bit-main"          # 數據/比特
    "StormCar820"       # 風暴車隊
    "Ju艦隊終極改名召喚儀式"  # 艦隊召喚
    "Wshao777"          # 主權帳戶
    "GitHub Actions"    # CI/CD
)

# 依序合併每個分支
for branch in "${BRANCHES[@]}"; do
    echo -e "${GREEN}正在合併分支：${branch}${NC}"
    
    # 檢查分支是否存在
    if git show-ref --verify --quiet refs/heads/"$branch"; then
        # 合併分支，保留歷史
        if git merge "$branch" --no-ff -m "合併 ${branch} 到 Goddess-mine（女神院主分支）"; then
            echo -e "${GREEN}✅ 成功合併 ${branch}${NC}"
        else
            echo -e "${RED}❌ 合併 ${branch} 時發生衝突，請手動解決${NC}"
            echo "解決衝突後，執行：git add . && git commit"
            exit 1
        fi
    else
        echo -e "${RED}❌ 分支 ${branch} 不存在${NC}"
    fi
done

echo -e "${GREEN}🎉 所有分支合併完成！${NC}"
echo -e "合併記錄：git log --oneline --graph --all"
