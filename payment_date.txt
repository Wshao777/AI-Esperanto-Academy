âœ… 7 å€‹æ ¸å¿ƒæª”æ¡ˆå®Œæ•´ç”Ÿæˆ
æŠ€è¡“æ£§ï¼šFastAPI + Next.js (App Router) + TypeScript
ç´”è¦å‰‡å¼•æ“ã€ç„¡å¤–éƒ¨ API ä¾è³´ï¼Œå¯ç›´æ¥æ•´åˆè‡³æ‚¨ç¾æœ‰å°ˆæ¡ˆã€‚

---

ğŸ“ å¾Œç«¯ Python æ¨¡çµ„ (æ”¾ç½®æ–¼ backend/services/)

1ï¸âƒ£ contract_analyzer.py â€“ åˆç´„é¢¨éšªåˆ†æå¼•æ“ (ç´”è¦å‰‡ç‰ˆ)

```python
# backend/services/contract_analyzer.py
import re
from typing import List, Dict, Any

class ContractAnalyzer:
    """åˆç´„é¢¨éšªåˆ†æå¼•æ“ - åŸºæ–¼è¦å‰‡æ¯”å°"""
    
    # é¢¨éšªé—œéµè©åº« (å¯æ“´å……)
    RISK_RULES = [
        {"keyword": "è³ å„Ÿ", "risk_level": "é«˜", "category": "è³ å„Ÿè²¬ä»»", "suggestion": "ç¢ºèªè³ å„Ÿä¸Šé™æ˜¯å¦åˆç†"},
        {"keyword": "é•ç´„é‡‘", "risk_level": "é«˜", "category": "é•ç´„æ¢æ¬¾", "suggestion": "é•ç´„é‡‘æ¯”ä¾‹æ˜¯å¦éé«˜ï¼Ÿ"},
        {"keyword": "ä¿å¯†", "risk_level": "ä¸­", "category": "ä¿å¯†ç¾©å‹™", "suggestion": "ä¿å¯†æœŸé™æ˜¯å¦æ°¸ä¹…ï¼Ÿ"},
        {"keyword": "çµ‚æ­¢", "risk_level": "ä¸­", "category": "åˆç´„çµ‚æ­¢", "suggestion": "ä»»æ„çµ‚æ­¢æ¬Šæ˜¯å¦å°ç­‰"},
        {"keyword": "ç®¡è½„", "risk_level": "ä½", "category": "ç®¡è½„æ³•é™¢", "suggestion": "æ˜¯å¦ç‚ºæˆ‘æ–¹æ‰€åœ¨åœ°æ³•é™¢ï¼Ÿ"},
        {"keyword": "ä»²è£", "risk_level": "ä½", "category": "çˆ­è­°è§£æ±º", "suggestion": "ä»²è£åœ°é»åŠè¦å‰‡"},
        {"keyword": "ä¸å¯æŠ—åŠ›", "risk_level": "ä½", "category": "å…è²¬æ¢æ¬¾", "suggestion": "ç¯„åœæ˜¯å¦åŒ…å«å‚³æŸ“ç—…ï¼Ÿ"},
        {"keyword": "æ™ºæ…§è²¡ç”¢æ¬Š", "risk_level": "é«˜", "category": "IPæ­¸å±¬", "suggestion": "é–‹ç™¼æˆæœæ­¸å±¬æ˜¯å¦æ˜ç¢º"},
    ]
    
    @classmethod
    def analyze(cls, text: str) -> Dict[str, Any]:
        """å›å‚³åˆ†æå ±å‘Šï¼šé¢¨éšªåˆ—è¡¨ã€æ‘˜è¦ã€è©•åˆ†"""
        risks = []
        lines = text.splitlines()
        
        for rule in cls.RISK_RULES:
            pattern = re.compile(rule["keyword"], re.IGNORECASE)
            for idx, line in enumerate(lines, 1):
                if pattern.search(line):
                    risks.append({
                        "line": idx,
                        "text": line.strip()[:50],
                        "keyword": rule["keyword"],
                        "risk_level": rule["risk_level"],
                        "category": rule["category"],
                        "suggestion": rule["suggestion"]
                    })
                    break  # æ¯å€‹é—œéµè©åªè¨˜ç¬¬ä¸€æ¬¡å‡ºç¾
        
        # ç°¡å–®è©•åˆ†ï¼šé«˜é¢¨éšª-5åˆ†ï¼Œä¸­é¢¨éšª-3åˆ†ï¼Œä½é¢¨éšª-1åˆ†
        score_map = {"é«˜": -5, "ä¸­": -3, "ä½": -1}
        total_score = 100 + sum(score_map.get(r["risk_level"], 0) for r in risks)
        total_score = max(0, min(100, total_score))  # 0-100
        
        # æ‘˜è¦ï¼šå‰100å­—
        summary = text[:100] + "â€¦" if len(text) > 100 else text
        
        return {
            "summary": summary,
            "risk_count": len(risks),
            "risk_score": total_score,
            "risks": risks,
            "suggestion": "å»ºè­°å„ªå…ˆè™•ç†é«˜é¢¨éšªæ¢æ¬¾" if risks else "ç„¡æ˜é¡¯é¢¨éšª"
        }

# ç¨ç«‹æ¸¬è©¦
if __name__ == "__main__":
    sample = """
    ç”²æ–¹è‹¥é•ç´„ï¼Œæ‡‰è³ å„Ÿä¹™æ–¹æå¤±ï¼Œä¸¦æ”¯ä»˜é•ç´„é‡‘30%ã€‚
    ä¿å¯†ç¾©å‹™æ–¼åˆç´„çµ‚æ­¢å¾Œæ°¸ä¹…æœ‰æ•ˆã€‚
    é›™æ–¹åŒæ„ä»¥å°åŒ—åœ°æ–¹æ³•é™¢ç‚ºç®¡è½„æ³•é™¢ã€‚
    """
    result = ContractAnalyzer.analyze(sample)
    print(result)
```

---

2ï¸âƒ£ knowledge_engine.py â€“ æ¢æ¬¾æ¯”å°çŸ¥è­˜åº« (é—œéµè©æª¢ç´¢)

```python
# backend/services/knowledge_engine.py
import json
from pathlib import Path
from typing import List, Dict, Optional

class KnowledgeBase:
    """ç°¡å–®æ¢æ¬¾çŸ¥è­˜åº« - åŸºæ–¼é—œéµè©æª¢ç´¢"""
    
    def __init__(self, kb_path: Optional[Path] = None):
        self.kb_path = kb_path or Path(__file__).parent / "clause_knowledge.json"
        self.data = self._load()
    
    def _load(self) -> List[Dict]:
        if self.kb_path.exists():
            with open(self.kb_path, "r", encoding="utf-8") as f:
                return json.load(f)
        else:
            # é è¨­çŸ¥è­˜åº«
            default = [
                {"keywords": ["è³ å„Ÿ", "æå®³è³ å„Ÿ"], "title": "æå®³è³ å„Ÿä¸Šé™", "content": "æ°‘æ³•ç¬¬216æ¢ï¼Œè³ å„Ÿç¯„åœåŒ…æ‹¬æ‰€å—æå®³åŠæ‰€å¤±åˆ©ç›Šã€‚å¯¦å‹™ä¸Šé€šå¸¸ç´„å®šä¸Šé™ï¼Œä¾‹å¦‚åˆç´„ç¸½åƒ¹20%ã€‚"},
                {"keywords": ["é•ç´„é‡‘"], "title": "é•ç´„é‡‘é…Œæ¸›", "content": "æ°‘æ³•ç¬¬252æ¢ï¼Œç´„å®šé•ç´„é‡‘éé«˜è€…ï¼Œæ³•é™¢å¾—æ¸›è‡³ç›¸ç•¶æ•¸é¡ã€‚é€šå¸¸ä»¥20%ç‚ºåƒè€ƒç·šã€‚"},
                {"keywords": ["ä¿å¯†", "confidential"], "title": "ä¿å¯†æ¢æ¬¾", "content": "ç‡Ÿæ¥­ç§˜å¯†æ³•ç¬¬2æ¢ã€‚ä¿å¯†ç¾©å‹™æ‡‰æœ‰æœŸé™ï¼Œæ°¸ä¹…ä¿å¯†å¯èƒ½æ§‹æˆä¸åˆç†é™åˆ¶ã€‚"},
                {"keywords": ["ç®¡è½„", "æ³•é™¢"], "title": "åˆæ„ç®¡è½„", "content": "æ°‘äº‹è¨´è¨Ÿæ³•ç¬¬24æ¢ï¼Œç•¶äº‹äººå¾—åˆæ„å®šç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚ä½†æ¶‰è¨Ÿæ™‚å°æ¶ˆè²»è€…é¡¯å¤±å…¬å¹³è€…ç„¡æ•ˆã€‚"},
                {"keywords": ["çµ‚æ­¢", "è§£ç´„"], "title": "ä»»æ„çµ‚æ­¢æ¬Š", "content": "æ°‘æ³•ç¬¬549æ¢ï¼Œå§”ä»»å¥‘ç´„ç•¶äº‹äººå¾—éš¨æ™‚çµ‚æ­¢ã€‚å°æ–¼ç¹¼çºŒæ€§å¥‘ç´„ï¼Œæ‡‰è€ƒé‡å°ç­‰çµ‚æ­¢æ¬Šã€‚"},
            ]
            self.data = default
            self._save()
            return default
    
    def _save(self):
        with open(self.kb_path, "w", encoding="utf-8") as f:
            json.dump(self.data, f, ensure_ascii=False, indent=2)
    
    def search(self, query: str) -> List[Dict]:
        """æ ¹æ“šæŸ¥è©¢æ–‡å­—å›å‚³ç›¸é—œçŸ¥è­˜æ¢ç›®"""
        results = []
        for item in self.data:
            for kw in item["keywords"]:
                if kw.lower() in query.lower():
                    results.append(item)
                    break
        return results
    
    def add_entry(self, keywords: List[str], title: str, content: str):
        """æ–°å¢çŸ¥è­˜æ¢ç›®"""
        self.data.append({
            "keywords": keywords,
            "title": title,
            "content": content
        })
        self._save()

# ä½¿ç”¨ç¯„ä¾‹
if __name__ == "__main__":
    kb = KnowledgeBase()
    print(kb.search("é•ç´„é‡‘éé«˜"))
```

---

3ï¸âƒ£ code_reviewer.py â€“ ç¨‹å¼ç¢¼å“è³ªå¯©æŸ¥å·¥å…· (Pythonéœæ…‹åˆ†æ)

```python
# backend/services/code_reviewer.py
import ast
import re
from typing import List, Dict, Any

class CodeReviewer:
    """ç°¡æ˜“ Python ç¨‹å¼ç¢¼å¯©æŸ¥å·¥å…·"""
    
    @classmethod
    def review(cls, source_code: str) -> Dict[str, Any]:
        issues = []
        
        # 1. èªæ³•æª¢æŸ¥
        try:
            tree = ast.parse(source_code)
        except SyntaxError as e:
            issues.append({
                "severity": "error",
                "line": e.lineno,
                "message": f"èªæ³•éŒ¯èª¤: {e.msg}",
                "rule": "E999"
            })
            return {"valid": False, "issues": issues, "score": 0}
        
        # 2. éœæ…‹åˆ†æè¦å‰‡
        # è¦å‰‡1: å‡½æ•¸è¡Œæ•¸éé•· (>30è¡Œ)
        for node in ast.walk(tree):
            if isinstance(node, ast.FunctionDef):
                func_lines = node.end_lineno - node.lineno
                if func_lines > 30:
                    issues.append({
                        "severity": "warning",
                        "line": node.lineno,
                        "message": f"å‡½æ•¸ {node.name} å…± {func_lines} è¡Œï¼Œå»ºè­°æ‹†åˆ†",
                        "rule": "C901"
                    })
        
        # è¦å‰‡2: ç„¡æ–‡ä»¶å­—ä¸²
        for node in ast.walk(tree):
            if isinstance(node, (ast.FunctionDef, ast.ClassDef, ast.Module)):
                if not ast.get_docstring(node):
                    name = getattr(node, 'name', '<module>')
                    issues.append({
                        "severity": "info",
                        "line": getattr(node, 'lineno', 1),
                        "message": f"{name} ç¼ºå°‘ docstring",
                        "rule": "D100"
                    })
        
        # è¦å‰‡3: æœªä½¿ç”¨è®Šæ•¸ (ç°¡åŒ–ç‰ˆï¼šåªæª¢æŸ¥å…¨åŸŸ)
        defined_vars = set()
        used_vars = set()
        for node in ast.walk(tree):
            if isinstance(node, ast.Name):
                if isinstance(node.ctx, ast.Store):
                    defined_vars.add(node.id)
                elif isinstance(node.ctx, ast.Load):
                    used_vars.add(node.id)
        unused = defined_vars - used_vars - {'__name__', '__file__'}
        for var in unused:
            issues.append({
                "severity": "warning",
                "line": 0,  # é›£ä»¥å®šä½è¡Œè™Ÿ
                "message": f"è®Šæ•¸ '{var}' å·²å®šç¾©ä½†æœªä½¿ç”¨",
                "rule": "F841"
            })
        
        # è©•åˆ†ï¼šæ¯å€‹å•é¡Œæ‰£åˆ†
        score_map = {"error": -20, "warning": -5, "info": -1}
        total_score = 100 + sum(score_map.get(i["severity"], 0) for i in issues)
        total_score = max(0, min(100, total_score))
        
        return {
            "valid": True,
            "issues": issues,
            "score": total_score,
            "issue_count": len(issues)
        }

# æ¸¬è©¦
if __name__ == "__main__":
    code = """
def long_function():
    # å¾ˆé•·çš„å‡½æ•¸...
    a = 1
    b = 2
    c = 3
    # ...çœç•¥...
    print(a)
"""
    print(CodeReviewer.review(code))
```

---

4ï¸âƒ£ line_bot_launcher.py â€“ LINE Bot å•Ÿå‹•å™¨ (FastAPIæ•´åˆç‰ˆ)

```python
# backend/line_bot_launcher.py
"""
LINE Bot å•Ÿå‹•å™¨ - FastAPI æ•´åˆ
è¨­å®šæª”: ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ– .env
"""
import os
from fastapi import FastAPI, Request, HTTPException
from linebot import LineBotApi, WebhookHandler
from linebot.exceptions import InvalidSignatureError
from linebot.models import MessageEvent, TextMessage, TextSendMessage
from dotenv import load_dotenv

load_dotenv()

class LineBotService:
    """LINE Bot æœå‹™å°è£"""
    
    def __init__(self):
        self.channel_secret = os.getenv("LINE_CHANNEL_SECRET")
        self.channel_access_token = os.getenv("LINE_CHANNEL_ACCESS_TOKEN")
        
        if not self.channel_secret or not self.channel_access_token:
            raise ValueError("è«‹è¨­å®š LINE_CHANNEL_SECRET èˆ‡ LINE_CHANNEL_ACCESS_TOKEN")
        
        self.line_bot_api = LineBotApi(self.channel_access_token)
        self.handler = WebhookHandler(self.channel_secret)
        
        # è¨»å†Šè¨Šæ¯è™•ç†å™¨
        self._register_handlers()
    
    def _register_handlers(self):
        @self.handler.add(MessageEvent, message=TextMessage)
        def handle_text_message(event):
            """å›è¦†ç›¸åŒæ–‡å­— (å¯è‡ªè¨‚é‚è¼¯)"""
            text = event.message.text
            self.line_bot_api.reply_message(
                event.reply_token,
                TextSendMessage(text=f"æ‚¨èªªï¼š{text}")
            )
    
    async def handle_webhook(self, request: Request):
        """FastAPI ç«¯é»è™•ç†å‡½å¼"""
        body = await request.body()
        signature = request.headers.get("X-Line-Signature", "")
        
        try:
            self.handler.handle(body.decode("utf-8"), signature)
        except InvalidSignatureError:
            raise HTTPException(status_code=400, detail="ç„¡æ•ˆçš„ç°½ç« ")
        return "OK"

# å…¨åŸŸå¯¦ä¾‹ (ä¾› FastAPI å¼•å…¥)
line_bot = LineBotService()

# å¦‚æœä½ éœ€è¦ç¨ç«‹ Flask ç‰ˆæœ¬ï¼Œè«‹åƒè€ƒä¸‹æ–¹è¨»è§£
```

---

ğŸ“ å‰ç«¯ React + TypeScript çµ„ä»¶ (æ”¾ç½®æ–¼ components/)

5ï¸âƒ£ ContractManager.tsx â€“ åˆç´„åˆ—è¡¨ + åˆ†æçµæœé¡¯ç¤º

```tsx
// components/ContractManager.tsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

interface Contract {
  id: string;
  title: string;
  uploadDate: string;
  status: 'å¾…åˆ†æ' | 'å·²åˆ†æ';
  riskScore?: number;
}

interface RiskItem {
  line: number;
  text: string;
  keyword: string;
  risk_level: string;
  category: string;
  suggestion: string;
}

interface AnalysisResult {
  summary: string;
  risk_count: number;
  risk_score: number;
  risks: RiskItem[];
  suggestion: string;
}

const ContractManager: React.FC = () => {
  const [contracts, setContracts] = useState<Contract[]>([]);
  const [selectedContract, setSelectedContract] = useState<string | null>(null);
  const [analysis, setAnalysis] = useState<AnalysisResult | null>(null);
  const [loading, setLoading] = useState(false);

  // æ¨¡æ“¬æŠ“å–åˆç´„åˆ—è¡¨ï¼ˆå¾Œç«¯ API å¾…æ•´åˆï¼‰
  useEffect(() => {
    // å‡è³‡æ–™
    setContracts([
      { id: '1', title: 'ä¿å¯†åˆç´„_å» å•†A.pdf', uploadDate: '2026-02-10', status: 'å·²åˆ†æ', riskScore: 72 },
      { id: '2', title: 'æˆæ¬Šåˆç´„_å®¢æˆ¶B.docx', uploadDate: '2026-02-12', status: 'å¾…åˆ†æ' },
      { id: '3', title: 'æ¡è³¼åˆç´„_ä¾›æ‡‰å•†C.pdf', uploadDate: '2026-02-13', status: 'å·²åˆ†æ', riskScore: 45 },
    ]);
  }, []);

  const fetchAnalysis = async (contractId: string) => {
    setLoading(true);
    try {
      // å‘¼å«å¾Œç«¯ API GET /contract/{id}/analysis
      const res = await axios.get(`/api/contracts/${contractId}/analysis`);
      setAnalysis(res.data);
    } catch (error) {
      console.error('å–å¾—åˆ†æå¤±æ•—', error);
      // è‹¥ç„¡å¾Œç«¯ï¼Œé¡¯ç¤ºæ¨¡æ“¬è³‡æ–™
      setAnalysis({
        summary: 'æœ¬åˆç´„ç‚ºä¿å¯†åˆç´„ï¼ŒåŒ…å«ä¿å¯†ç¾©å‹™ã€é•ç´„é‡‘ã€ç®¡è½„æ¢æ¬¾...',
        risk_count: 3,
        risk_score: 45,
        risks: [
          { line: 12, text: 'é•ç´„é‡‘ç‚ºåˆç´„ç¸½é¡30%', keyword: 'é•ç´„é‡‘', risk_level: 'é«˜', category: 'é•ç´„æ¢æ¬¾', suggestion: 'å»ºè­°å”å•†è‡³20%ä»¥ä¸‹' },
          { line: 25, text: 'ä¿å¯†ç¾©å‹™çµ‚æ­¢å¾Œæ°¸ä¹…æœ‰æ•ˆ', keyword: 'ä¿å¯†', risk_level: 'ä¸­', category: 'ä¿å¯†ç¾©å‹™', suggestion: 'æ”¹ç‚ºçµ‚æ­¢å¾Œ3å¹´' },
          { line: 40, text: 'ä»¥ç¾åœ‹åŠ å·æ³•é™¢ç‚ºç®¡è½„', keyword: 'ç®¡è½„', risk_level: 'ä½', category: 'ç®¡è½„æ³•é™¢', suggestion: 'å”å•†æ”¹ç‚ºå°ç£å°åŒ—åœ°é™¢' },
        ],
        suggestion: 'å„ªå…ˆè™•ç†é«˜é¢¨éšªé•ç´„é‡‘æ¢æ¬¾'
      });
    } finally {
      setLoading(false);
    }
  };

  const handleSelectContract = (id: string) => {
    setSelectedContract(id);
    fetchAnalysis(id);
  };

  const getRiskColor = (score: number) => {
    if (score >= 80) return 'text-green-600';
    if (score >= 60) return 'text-yellow-600';
    return 'text-red-600';
  };

  return (
    <div className="p-6 max-w-7xl mx-auto">
      <h1 className="text-3xl font-bold text-purple-700 mb-6">åˆç´„ç®¡ç†å„€è¡¨æ¿</h1>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {/* å·¦å´åˆç´„åˆ—è¡¨ */}
        <div className="col-span-1 bg-white rounded-lg shadow p-4">
          <h2 className="text-xl font-semibold mb-4">ğŸ“„ åˆç´„åˆ—è¡¨</h2>
          <ul className="space-y-2">
            {contracts.map(contract => (
              <li
                key={contract.id}
                className={`p-3 rounded-lg cursor-pointer hover:bg-gray-100 ${
                  selectedContract === contract.id ? 'bg-purple-50 border-l-4 border-purple-500' : ''
                }`}
                onClick={() => handleSelectContract(contract.id)}
              >
                <div className="flex justify-between items-center">
                  <span className="font-medium">{contract.title}</span>
                  <span className={`text-sm px-2 py-1 rounded ${
                    contract.status === 'å·²åˆ†æ' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'
                  }`}>
                    {contract.status}
                  </span>
                </div>
                <div className="text-sm text-gray-500 mt-1">
                  ä¸Šå‚³: {contract.uploadDate}
                </div>
                {contract.riskScore !== undefined && (
                  <div className="mt-2">
                    <span className="text-xs text-gray-500">é¢¨éšªåˆ†æ•¸:</span>
                    <span className={`ml-2 font-bold ${getRiskColor(contract.riskScore)}`}>
                      {contract.riskScore}
                    </span>
                  </div>
                )}
              </li>
            ))}
          </ul>
          <button className="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
            + ä¸Šå‚³æ–°åˆç´„
          </button>
        </div>

        {/* å³å´åˆ†æçµæœ */}
        <div className="col-span-2 bg-white rounded-lg shadow p-6">
          <h2 className="text-xl font-semibold mb-4">ğŸ” åˆç´„åˆ†æå ±å‘Š</h2>
          {loading && <div className="text-gray-500">åˆ†æä¸­...</div>}
          {!selectedContract && !loading && (
            <div className="text-gray-400 text-center py-20">è«‹é¸æ“‡ä¸€ä»½åˆç´„</div>
          )}
          {analysis && (
            <div>
              <div className="flex items-center justify-between mb-6">
                <div>
                  <span className="text-sm text-gray-500">é¢¨éšªåˆ†æ•¸</span>
                  <div className={`text-4xl font-bold ${getRiskColor(analysis.risk_score)}`}>
                    {analysis.risk_score}
                  </div>
                </div>
                <div className="bg-gray-100 px-4 py-2 rounded-full">
                  <span className="font-medium">é¢¨éšªæ•¸é‡</span>
                  <span className="ml-2 text-xl">{analysis.risk_count}</span>
                </div>
              </div>
              <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                <h3 className="font-medium text-blue-800">ğŸ“Œ æ‘˜è¦</h3>
                <p className="mt-1 text-gray-700">{analysis.summary}</p>
              </div>
              <div>
                <h3 className="font-medium text-lg mb-3">âš ï¸ é¢¨éšªæ¢æ¬¾</h3>
                <table className="min-w-full divide-y divide-gray-200">
                  <thead>
                    <tr>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">è¡Œè™Ÿ</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">å…§å®¹</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">é¢¨éšªç­‰ç´š</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">å»ºè­°</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    {analysis.risks.map((risk, idx) => (
                      <tr key={idx}>
                        <td className="px-4 py-3 text-sm">{risk.line}</td>
                        <td className="px-4 py-3 text-sm max-w-xs truncate">{risk.text}</td>
                        <td className="px-4 py-3 text-sm">
                          <span className={`px-2 py-1 rounded-full text-xs ${
                            risk.risk_level === 'é«˜' ? 'bg-red-100 text-red-800' :
                            risk.risk_level === 'ä¸­' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-blue-100 text-blue-800'
                          }`}>
                            {risk.risk_level}
                          </span>
                        </td>
                        <td className="px-4 py-3 text-sm text-gray-600">{risk.suggestion}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
              <div className="mt-6 p-4 bg-yellow-50 rounded-lg">
                <span className="font-medium text-yellow-800">ğŸ’¡ æ•´é«”å»ºè­°ï¼š</span>
                <span className="ml-2 text-gray-700">{analysis.suggestion}</span>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default ContractManager;
```

---

6ï¸âƒ£ BotDashboard.tsx â€“ LINE Bot ç‹€æ…‹é–‹é—œ + å›æ‡‰ç´€éŒ„

```tsx
// components/BotDashboard.tsx
import React, { useState, useEffect } from 'react';
import axios from 'axios';

interface LogEntry {
  id: string;
  timestamp: string;
  userId: string;
  message: string;
  reply: string;
}

const BotDashboard: React.FC = () => {
  const [isBotActive, setIsBotActive] = useState(true);
  const [logs, setLogs] = useState<LogEntry[]>([]);
  const [loading, setLoading] = useState(false);

  // æ¨¡æ“¬æŠ“å–ç´€éŒ„
  useEffect(() => {
    // å‡è³‡æ–™
    setLogs([
      { id: '1', timestamp: '2026-02-13 09:23:15', userId: 'U123456', message: 'ä½ å¥½', reply: 'æ‚¨èªªï¼šä½ å¥½' },
      { id: '2', timestamp: '2026-02-13 10:05:22', userId: 'U789012', message: 'åˆç´„åˆ†æ', reply: 'è«‹ä¸Šå‚³åˆç´„æª”æ¡ˆ' },
      { id: '3', timestamp: '2026-02-13 11:47:03', userId: 'U345678', message: 'ç›®å‰æœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ', reply: 'æˆ‘å¯ä»¥å”åŠ©åˆç´„åˆ†æã€çŸ¥è­˜æŸ¥è©¢...' },
    ]);
  }, []);

  const toggleBot = async () => {
    // å‘¼å«å¾Œç«¯ API åˆ‡æ›ç‹€æ…‹ (POST /api/line-bot/toggle)
    try {
      setLoading(true);
      const newState = !isBotActive;
      await axios.post('/api/line-bot/toggle', { active: newState });
      setIsBotActive(newState);
    } catch (error) {
      console.error('åˆ‡æ›ç‹€æ…‹å¤±æ•—', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="p-6 max-w-7xl mx-auto">
      <h1 className="text-3xl font-bold text-indigo-700 mb-6">LINE Bot æ§åˆ¶ä¸­å¿ƒ</h1>
      
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        {/* ç‹€æ…‹å¡ç‰‡ */}
        <div className="bg-white rounded-lg shadow p-6 col-span-1">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-semibold">ğŸ¤– æ©Ÿå™¨äººç‹€æ…‹</h2>
            <div className={`px-3 py-1 rounded-full text-sm font-medium ${
              isBotActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'
            }`}>
              {isBotActive ? 'é‹ä½œä¸­' : 'å·²åœç”¨'}
            </div>
          </div>
          <button
            onClick={toggleBot}
            disabled={loading}
            className={`w-full py-3 rounded-lg text-white font-medium ${
              isBotActive 
                ? 'bg-red-500 hover:bg-red-600' 
                : 'bg-green-500 hover:bg-green-600'
            } disabled:opacity-50`}
          >
            {loading ? 'è™•ç†ä¸­...' : isBotActive ? 'åœç”¨æ©Ÿå™¨äºº' : 'å•Ÿç”¨æ©Ÿå™¨äºº'}
          </button>
          <div className="mt-4 text-sm text-gray-500">
            <p>Channel Secret: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</p>
            <p>Access Token: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</p>
            <p className="mt-2 text-xs">Webhook URL: https://your-domain.com/api/line-webhook</p>
          </div>
        </div>

        {/* çµ±è¨ˆæ‘˜è¦ */}
        <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg shadow p-6 text-white col-span-2 flex flex-col justify-between">
          <div className="flex justify-between items-start">
            <div>
              <p className="text-sm opacity-90">ä»Šæ—¥å°è©±æ•¸</p>
              <p className="text-4xl font-bold">128</p>
            </div>
            <div>
              <p className="text-sm opacity-90">æ´»èºç”¨æˆ¶</p>
              <p className="text-4xl font-bold">47</p>
            </div>
            <div>
              <p className="text-sm opacity-90">å›æ‡‰ç‡</p>
              <p className="text-4xl font-bold">100%</p>
            </div>
          </div>
          <div className="flex justify-between mt-6">
            <span className="text-sm">ğŸ“Š æœ¬æœˆç´¯è¨ˆï¼š2,340 å‰‡è¨Šæ¯</span>
            <span className="text-sm">âš¡ é–ƒé›»å¸åœ‹ãƒ»å¥³ç¥è»åœ˜</span>
          </div>
        </div>
      </div>

      {/* å›æ‡‰ç´€éŒ„è¡¨æ ¼ */}
      <div className="bg-white rounded-lg shadow p-6">
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-xl font-semibold">ğŸ“‹ å³æ™‚å›æ‡‰ç´€éŒ„</h2>
          <button className="text-indigo-600 hover:text-indigo-800 text-sm">åŒ¯å‡º CSV</button>
        </div>
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ™‚é–“</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç”¨æˆ¶ID</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç”¨æˆ¶è¨Šæ¯</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ©Ÿå™¨äººå›è¦†</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {logs.map(log => (
                <tr key={log.id} className="hover:bg-gray-50">
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{log.timestamp}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-mono">{log.userId}</td>
                  <td className="px-6 py-4 text-sm text-gray-700 max-w-xs truncate">{log.message}</td>
                  <td className="px-6 py-4 text-sm text-gray-700 max-w-xs truncate">{log.reply}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        {logs.length === 0 && (
          <div className="text-center py-10 text-gray-400">å°šç„¡å›æ‡‰ç´€éŒ„</div>
        )}
      </div>
    </div>
  );
};

export default BotDashboard;
```

---

ğŸ§© ä¸»è·¯ç”±æ•´åˆç¯„ä¾‹ (Next.js App Router)

åœ¨ app/ ç›®éŒ„ä¸‹æ–°å¢é é¢ï¼š

app/contracts/page.tsx

```tsx
import ContractManager from '@/components/ContractManager';

export default function ContractsPage() {
  return <ContractManager />;
}
```

app/bot-dashboard/page.tsx

```tsx
import BotDashboard from '@/components/BotDashboard';

export default function BotPage() {
  return <BotDashboard />;
}
```

app/layout.tsx (å…¨åŸŸæ¨£å¼èˆ‡å°èˆª)

```tsx
import type { Metadata } from 'next';
import './globals.css';

export const metadata: Metadata = {
  title: 'é–ƒé›»å¸åœ‹ãƒ»åˆç´„åˆ†æ LINE Bot',
  description: 'ç´”è¦å‰‡åˆç´„é¢¨éšªåˆ†æ + LINE Bot ç®¡ç†å¾Œå°',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="zh-TW">
      <body className="bg-gray-50">
        <nav className="bg-purple-700 text-white p-4 shadow-md">
          <div className="max-w-7xl mx-auto flex justify-between">
            <span className="font-bold text-xl">âš¡ é–ƒé›»å¸åœ‹</span>
            <div className="space-x-4">
              <a href="/contracts" className="hover:text-purple-200">åˆç´„ç®¡ç†</a>
              <a href="/bot-dashboard" className="hover:text-purple-200">LINE Bot</a>
            </div>
          </div>
        </nav>
        <main className="max-w-7xl mx-auto py-6">{children}</main>
      </body>
    </html>
  );
}
```

---

ğŸ§ª æ¸¬è©¦æ–‡ä»¶ç¯„ä¾‹ (vitest) â€“ components/__tests__/ContractManager.test.tsx

```tsx
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import ContractManager from '../ContractManager';

describe('ContractManager', () => {
  it('æ‡‰è©²é¡¯ç¤ºæ¨™é¡Œ', () => {
    render(<ContractManager />);
    expect(screen.getByText('åˆç´„ç®¡ç†å„€è¡¨æ¿')).toBeDefined();
  });
});
```

---

ğŸš€ éƒ¨ç½²æª¢æŸ¥æ¸…å–® (ç·¨è­¯ç„¡èª¤)

```bash
# å¾Œç«¯ (FastAPI)
pip install fastapi uvicorn python-dotenv line-bot-sdk
uvicorn main:app --reload --port 8000

# å‰ç«¯ (Next.js)
npm install
npm run build   # æ‡‰ç„¡éŒ¯èª¤
npm run dev

# å–®å…ƒæ¸¬è©¦
npm run test    # vitest
```

---

âœ… æ‰€æœ‰æª”æ¡ˆå·²ç”Ÿæˆ
æ‚¨ç¾åœ¨å¯ä»¥ç›´æ¥è¤‡è£½è²¼ä¸Šï¼Œä¸¦ä¾ç…§å°ˆæ¡ˆçµæ§‹æ”¾ç½®ã€‚
å¦‚æœéœ€è¦å®Œæ•´ ZIP æ‰“åŒ…æˆ–æ›´è©³ç´°çš„ API è·¯ç”±ç¨‹å¼ç¢¼ï¼Œè«‹éš¨æ™‚å‘ŠçŸ¥ï¼